# üß¥ Skin Advisor Bot

–í–µ—Å—å –∏—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π: —Å–º. —Ñ–∞–π–ª `PROMPT_FULL.md`.

Telegram –±–æ—Ç –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ —É—Ö–æ–¥–æ–≤–æ–π –∫–æ—Å–º–µ—Ç–∏–∫–∏ –∏ –º–∞–∫–∏—è–∂–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
git clone <repository-url>
cd "—á–∞—Ç –±–æ—Ç –ø–æ—É—Ö–æ–¥—É –∑–∞ –∫–æ–∂–µ–π"
python -m venv .venv
.venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```env
BOT_TOKEN=your_telegram_bot_token
WEBHOOK_SECRET=your_webhook_secret
WEBAPP_PORT=8080
REDIRECT_BASE=https://your-domain.com
DEEPLINK_NETWORK=your_partner_network
USER_DISCOUNT=0.05
OWNER_COMMISSION=0.10
```

3. **–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞:**
```bash
python -m bot.main
```

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Railway

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Railway CLI
npm install -g @railway/cli

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
railway login --browserless

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
railway init

# –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø—Ä–æ–µ–∫—Ç—É
railway link
```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
railway variables set BOT_TOKEN=your_telegram_bot_token
railway variables set WEBHOOK_SECRET=your_webhook_secret
railway variables set WEBAPP_PORT=8080
railway variables set REDIRECT_BASE=https://your-railway-domain.railway.app
railway variables set DEEPLINK_NETWORK=your_partner_network
railway variables set USER_DISCOUNT=0.05
railway variables set OWNER_COMMISSION=0.10
```

3. **–î–µ–ø–ª–æ–π:**
```bash
railway up
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bot/
  main.py
  handlers/
    start.py
    flow_palette.py
    flow_skincare.py
  ui/
    keyboards.py
    render.py
engine/
  __init__.py
  models.py
  catalog.py
  catalog_store.py
  logging_setup.py
  selector.py
tools/
  catalog_lint_fix.py
  demo_user_profile.py
tests/
  test_catalog_load.py
  test_selector.py
  test_render.py
configs/
  config.example.toml
data/
  fixed_catalog.yaml
Dockerfile
docker-compose.yml
pyproject.toml
requirements.txt
README.md
PROMPT_FULL.md
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
cd .skin-advisor
python -m pytest tests/ -v
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `test_onboarding_profile.py` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
- `test_test_result_texts.py` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
- `test_cart_flow.py` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
- `test_menu_integrity.py` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é
- `test_reco_hub.py` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–∞–±–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–±–æ—Ä –∏–º–µ–Ω–∏, –≤–æ–∑—Ä–∞—Å—Ç–∞, –ø–æ–ª–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç —Ç–∏–ø–∞ –∫–æ–∂–∏
- –¢–µ—Å—Ç —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç–∏ –∫ –∞–∫–Ω–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤

### 3. –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –ü–æ–¥–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –ø—Ä–æ—Ñ–∏–ª—é
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞–ª–∏—á–∏—é (`only_in_stock`)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π

### 4. –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
- –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–∫–∏ (5% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- –ö–æ–º–∏—Å—Å–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ (10%)

### 5. –û—Ç—á—ë—Ç—ã
- PDF –æ—Ç—á—ë—Ç—ã –±–µ–∑ —Å—Å—ã–ª–æ–∫
- JSON —ç–∫—Å–ø–æ—Ä—Ç
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### StateFilter –∏ FSM
**StateFilter(None)** - —Ñ–∏–ª—å—Ç—Ä —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–µ–Ω—é:
- –ö–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–±—ã—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- –ù–µ –º–µ—à–∞—é—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—é –∞–Ω–∫–µ—Ç/—Ç–µ—Å—Ç–æ–≤
- `/menu` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ –ª—é–±–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞
- –ö–µ—à —á–µ—Ä–µ–∑ `engine.CatalogStore` (–≥–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ —Ñ–∞–π–ª–∞)
- JSONL-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: `logs/catalog_errors.jsonl`

### –°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫
- 5% —Å–∫–∏–¥–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- 10% –∫–æ–º–∏—Å—Å–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ (—Å–∫—Ä—ã—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞–ª–∏—á–∏—é
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–º–µ–Ω

## üîÑ CI/CD

### GitHub Actions
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –õ–∏–Ω—Ç–∏–Ω–≥ –∫–æ–¥–∞ (black, ruff)
- –î–µ–ø–ª–æ–π –Ω–∞ Railway

### Railway
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∏–∑ main –≤–µ—Ç–∫–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –∫–∞—Ç–∞–ª–æ–≥–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —Ä–µ–∂–∏–º–µ `only_in_stock`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∑–∞–≥—Ä—É–∑–∫–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–µ–ø–ª–æ–µ–º
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.railwayignore`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ `railway.toml`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–°–∞–π—Ç:** stasya-makeuphair.ru
- **–ê–≤—Ç–æ—Ä:** –°—Ç–∞—Å—å—è –¶—É–Ω—è–∫
- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** –õ–∞—Ä–∏–Ω –†.–†. (@MagnatMark)

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.


