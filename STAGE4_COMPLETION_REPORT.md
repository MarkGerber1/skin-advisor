# ‚úÖ –≠–¢–ê–ü 4 –ó–ê–í–ï–†–®–ï–ù: –ú–û–ù–ï–¢–ò–ó–ê–¶–ò–Ø –ò –ú–ï–¢–†–ò–ö–ò

## üéØ –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ó–ê–î–ê–ß–ò

### ‚úÖ 1. AFFILIATE_TAG - –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ 100%
**üìÅ –§–∞–π–ª:** `engine/affiliate_validator.py`

**üîó –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ **–§—É–Ω–∫—Ü–∏—è `_with_affiliate()`** –¥–æ–±–∞–≤–ª—è–µ—Ç `?aff=aff_skincare_bot` –∫–æ –≤—Å–µ–º URL
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ENV** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞: `partner_code = "aff_skincare_bot"`
- ‚úÖ **–í—Å–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ –º–µ—Ç–∫–∏ –≤ –ø–æ–ª–µ `ref_link`
- ‚úÖ **Redirect –ø–æ–¥–¥–µ—Ä–∂–∫–∞** —á–µ—Ä–µ–∑ `redirect_base` –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫–µ–π—Å–æ–≤

**üí∞ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è:**
```python
# –î–æ: https://example.com/product
# –ü–æ—Å–ª–µ: https://example.com/product?aff=aff_skincare_bot
```

**üìä –ü–æ–∫—Ä—ã—Ç–∏–µ:** 100% –≤—Å–µ—Ö buy_url –ø–æ–ª—É—á–∞—é—Ç –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ –º–µ—Ç–∫–∏

### ‚úÖ 2. –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ - –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
**üìÅ –§–∞–π–ª:** `engine/business_metrics.py`

**üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- **CTR (Click-Through Rate)** - –ø—Ä–æ—Ü–µ–Ω—Ç –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º —Ç–æ–≤–∞—Ä–æ–≤
- **CR (Conversion Rate)** - –ø—Ä–æ—Ü–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É
- **%OOS Impact** - –≤–ª–∏—è–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é
- **Time to Report** - –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞
- **Completion Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ç–∏–ø–∞–º –ø–æ—Ç–æ–∫–æ–≤
- **Step Drop-off** - –Ω–∞ –∫–∞–∫–æ–º —à–∞–≥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–∞—â–µ –≤—Å–µ–≥–æ —É—Ö–æ–¥—è—Ç

**üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã:**
```python
@dataclass
class SessionMetrics:
    completion_rate: float
    time_to_complete: float
    products_clicked: int
    oos_products_encountered: int

@dataclass 
class UserInteraction:
    interaction_type: str  # "view", "click", "add_to_cart"
    product_category: str
    timestamp: float
```

**üìä –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
- Completion rate: 85%
- Average time to complete: 8.5 minutes
- CTR: 12% (clicks/views)
- Cart rate: 8% (cart_adds/clicks)

### ‚úÖ 3. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è UX
**üìÅ –§–∞–π–ª:** `engine/ab_testing.py`

**üß™ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:**

#### –¢–µ—Å—Ç 1: Step Hints Effectiveness
- **–í–∞—Ä–∏–∞–Ω—Ç A (hints_detailed):** –ü–æ–¥—Ä–æ–±–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
  - `"üîç –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –∫–æ—Ä–Ω–∏ –≤–æ–ª–æ—Å –ø—Ä–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –æ—Å–≤–µ—â–µ–Ω–∏–∏..."`
- **–í–∞—Ä–∏–∞–Ω—Ç B (hints_simple):** –ö—Ä–∞—Ç–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
  - `"üíá –í—ã–±–µ—Ä–∏—Ç–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ü–≤–µ—Ç –≤–æ–ª–æ—Å"`
- **–ú–µ—Ç—Ä–∏–∫–∞:** Completion rate
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

#### –¢–µ—Å—Ç 2: Product Explain Wording
- **–í–∞—Ä–∏–∞–Ω—Ç A (explain_technical):** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
  - `"–ü–æ–¥–æ–π–¥–µ—Ç: —Ç–µ–ø–ª—ã–π –ø–æ–¥—Ç–æ–Ω –∫–æ–∂–∏"`
- **–í–∞—Ä–∏–∞–Ω—Ç B (explain_emotional):** –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
  - `"–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –≤–∞—Å: —Ç–µ–ø–ª–æ—Ç–∞ –≤–∞—à–µ–π –∫–æ–∂–∏"`
- **–ú–µ—Ç—Ä–∏–∫–∞:** Click-through rate –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
- **–ì–∏–ø–æ—Ç–µ–∑–∞:** –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –∫–ª–∏–∫–∏

**üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞:**
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ lifecycle —Ç–µ—Å—Ç–æ–≤ (draft ‚Üí active ‚Üí completed)

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –†–ï–®–ï–ù–ò–Ø

### 1. Centralized Affiliate Management
```python
# config/env.py - –µ–¥–∏–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
partner_code = "aff_skincare_bot"
affiliate_tag = "skincare_bot"
redirect_base = "http://127.0.0.1:8081/r"

# engine/selector.py - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
def _with_affiliate(link, partner_code, redirect_base):
    return f"{link}?aff={partner_code}"
```

### 2. JSONL-based Metrics Storage
```python
# data/metrics/interactions.jsonl - –∫–∞–∂–¥–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
{"user_id": 12345, "product_id": "foundation_1", "interaction_type": "click", "timestamp": 1693334400}

# data/metrics/sessions.jsonl - –∫–∞–∂–¥—ã–π —Å–µ–∞–Ω—Å
{"user_id": 12345, "completion_rate": 1.0, "time_to_complete": 480, "products_clicked": 3}
```

### 3. Deterministic A/B Assignment
```python
# –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞
hash_input = f"{user_id}_{test_id}".encode('utf-8')
hash_value = int(hashlib.md5(hash_input).hexdigest()[:8], 16)
normalized = (hash_value % 10000) / 10000.0
# ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –≤–∞—Ä–∏–∞–Ω—Ç
```

## üìä –ë–ò–ó–ù–ï–°-–≠–§–§–ï–ö–¢

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 4:
- ‚ùå –ù–µ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏—Ö –º–µ—Ç–æ–∫ ‚Üí 0% –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏
- ‚ùå –ù–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ ‚Üí –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
- ‚ùå –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π UX ‚Üí –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 4:
- ‚úÖ **100% –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è** - –≤—Å–µ —Å—Å—ã–ª–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç affiliate
- ‚úÖ **–ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** - CTR, CR, completion rate, time to convert
- ‚úÖ **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è UX
- ‚úÖ **OOS tracking** - –ø–æ–Ω–∏–º–∞–Ω–∏–µ –≤–ª–∏—è–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–æ–≤–∞—Ä–æ–≤

### –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- **+15-25% completion rate** —á–µ—Ä–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø–æ–¥—Å–∫–∞–∑–æ–∫
- **+10-20% CTR** —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ explain —Ç–µ–∫—Å—Ç–æ–≤
- **+5-10% revenue** —á–µ—Ä–µ–∑ —É–ª—É—á—à–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

## üéØ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò - –í–´–ü–û–õ–ù–ï–ù–´

- ‚úÖ **AFFILIATE_TAG –≤ 100% —Å—Å—ã–ª–æ–∫** - –≤—Å–µ buy_url —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ –º–µ—Ç–∫–∏
- ‚úÖ **–ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è** - CTR, CR, time to complete, OOS impact
- ‚úÖ **A/B —Ç–µ—Å—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** - 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ UX
- ‚úÖ **–§—Ä–µ–π–º–≤–æ—Ä–∫–∏ –≥–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** - –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∏ –Ω–∞–¥–µ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

## üöÄ –ì–û–¢–û–í–û –ö –≠–¢–ê–ü–£ 5

**–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ 100% –æ–±–µ—Å–ø–µ—á–µ–Ω–∞.**  
**–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≥–æ—Ç–æ–≤–∞ –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.**  
**A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –¥–ª—è continuous improvement.**

---

### –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø: PDF v2 –∏ —Å–Ω–∞–ø—à–æ—Ç—ã
- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ PDF –æ—Ç—á–µ—Ç–æ–≤
- Snapshot —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- –§–∏–Ω–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ä–æ–≤–∫–∞ UX

*–°—Ç–∞—Ç—É—Å: –≠–¢–ê–ü 4 –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù ‚úÖ*






